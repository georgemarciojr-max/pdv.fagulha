<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fagula Grill - PDV Offline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-hidden h-screen">

    <div id="app" class="h-full flex flex-col">

        <!-- TELA DE SELEÇÃO DE PERFIL -->
        <div id="perfil-view" class="flex flex-col items-center justify-center h-full bg-gray-800 p-4 fade-in">
            <div class="w-full max-w-sm bg-gray-900 p-8 rounded-2xl shadow-2xl text-center">
                <i class="fas fa-utensils text-5xl text-amber-400 mb-4"></i>
                <h1 class="text-4xl font-extrabold text-white mb-2">Fagula Grill</h1>
                <p class="text-gray-400 mb-8">Selecione seu perfil para iniciar</p>
                <div class="space-y-4">
                    <button onclick="selecionarPerfil('caixa')" class="w-full text-lg bg-blue-600 text-white font-bold py-4 px-4 rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-lg flex items-center justify-center gap-3"><i class="fas fa-cash-register"></i>Caixa</button>
                    <button onclick="selecionarPerfil('atendente')" class="w-full text-lg bg-green-600 text-white font-bold py-4 px-4 rounded-xl hover:bg-green-700 transition-all duration-300 shadow-lg flex items-center justify-center gap-3"><i class="fas fa-user-tie"></i>Atendente</button>
                    <button onclick="selecionarPerfil('cozinha')" class="w-full text-lg bg-orange-600 text-white font-bold py-4 px-4 rounded-xl hover:bg-orange-700 transition-all duration-300 shadow-lg flex items-center justify-center gap-3"><i class="fas fa-fire-burner"></i>Cozinha</button>
                </div>
                 <p class="text-green-500 text-sm mt-6">Sistema pronto para uso.</p>
            </div>
        </div>

        <!-- CONTEÚDO PRINCIPAL -->
        <div id="main-view" class="hidden h-full flex flex-col">
            <header class="bg-gray-900/80 backdrop-blur-sm p-4 flex justify-between items-center border-b border-gray-700">
                <div><h1 class="text-2xl font-bold" id="header-title"></h1></div>
                <button onclick="voltarParaPerfis()" class="bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors"><i class="fas fa-exchange-alt mr-2"></i>Trocar Perfil</button>
            </header>
            <main class="flex-1 overflow-y-auto p-4 sm:p-6">
                <div id="mesas-view" class="hidden"><div id="mesas-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-4"></div></div>
                <div id="cozinha-view" class="hidden"><div id="pedidos-cozinha-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>
            </main>
        </div>
        
        <!-- MODAIS (PDV, CAIXA) -->
        <div id="pdv-view" class="hidden fixed inset-0 bg-gray-900/70 backdrop-blur-sm flex items-center justify-center p-2 sm:p-4 z-50 fade-in"></div>
        <div id="caixa-detalhe-view" class="hidden fixed inset-0 bg-gray-900/70 backdrop-blur-sm flex items-center justify-center p-4 z-50 fade-in"></div>
        
        <!-- NOTIFICAÇÃO -->
        <div id="notification" class="hidden fixed bottom-5 right-5 bg-green-500 text-white py-3 px-5 rounded-lg shadow-xl"><p></p></div>
    </div>

    <script>
        // ===================================================================
        // ARQUITETURA DO SISTEMA
        // ===================================================================
        // - Sem Firebase: Toda a lógica de dados é controlada via Local Storage.
        // - O sistema é 100% autônomo e funciona offline.
        // - Cada dispositivo tem sua própria base de dados local.
        // ===================================================================

        // CARDÁPIO COMPLETO
        const cardapio = {
            "Espetos": [{ id: 'esp-carne', nome: 'Carne', preco: 7.00 }, { id: 'esp-coracao', nome: 'Coração', preco: 6.00 }, { id: 'esp-misto', nome: 'Misto', preco: 7.00 }, { id: 'esp-frango', nome: 'Frango', preco: 6.00 }, { id: 'esp-frangobacon', nome: 'Frango c/ Bacon', preco: 8.00 }, { id: 'esp-calabresa', nome: 'Calabresa', preco: 6.00 }, { id: 'esp-queijo', nome: 'Queijo Coalho', preco: 6.00 }, { id: 'esp-tulipa', nome: 'Tulipa', preco: 8.00 }],
            "Espetos Premium": [{ id: 'prem-filebacon', nome: 'Filé c/ Bacon', preco: 15.00 }, { id: 'prem-picanha', nome: 'Picanha', preco: 18.00 }],
            "Entradas": [{ id: 'batata-p', nome: 'Batata Frita P', preco: 15.00 }, { id: 'batata-g', nome: 'Batata Frita G', preco: 25.00 }, { id: 'batata-cheddarbacon', nome: 'Batata c/ Cheddar & Bacon', preco: 30.00 }, { id: 'aneis-cebola', nome: 'Anéis de Cebola (12un)', preco: 18.00 }],
            "Frango Frito": [{ id: 'frango-p', nome: 'Balde P (400g)', preco: 25.00 }, { id: 'frango-m', nome: 'Balde M (600g)', preco: 35.00 }, { id: 'frango-g', nome: 'Balde G (1kg)', preco: 55.00 }],
            "Hambúrgueres": [{ id: 'burg-classic', nome: 'Classic Burger', preco: 20.00 }, { id: 'burg-salad', nome: 'Salad Burger', preco: 22.00 }, { id: 'burg-bacon', nome: 'Bacon Burger', preco: 25.00 }, { id: 'burg-urban', nome: 'Urban Norte Burger', preco: 30.00 }],
            "Combos": [{ id: 'combo-classic', nome: 'Combo Classic', preco: 30.00 }, { id: 'combo-salad', nome: 'Combo Salad', preco: 32.00 }, { id: 'combo-bacon', nome: 'Combo Bacon', preco: 35.00 }],
            "Bebidas": [{ id: 'refri-lata', nome: 'Refrigerante Lata', preco: 5.00 }, { id: 'agua-com-gas', nome: 'Água c/ Gás', preco: 4.00 }, { id: 'agua-sem-gas', nome: 'Água s/ Gás', preco: 3.00 }, { id: 'h2oh', nome: 'H2OH!', preco: 6.00 }, { id: 'suco-lata', nome: 'Suco Lata', preco: 6.00 }, { id: 'energetico', nome: 'Energético', preco: 12.00 }],
            "Cervejas": [{ id: 'heineken-ln', nome: 'Heineken LN', preco: 10.00 }, { id: 'bud-ln', nome: 'Budweiser LN', preco: 9.00 }, { id: 'stella-ln', nome: 'Stella Artois LN', preco: 9.00 }, { id: 'heineken-600', nome: 'Heineken 600ml', preco: 18.00 }, { id: 'original-600', nome: 'Original 600ml', preco: 15.00 }, { id: 'bud-600', nome: 'Budweiser 600ml', preco: 15.00 }],
            "Sucos & Doses": [{ id: 'suco-jarra', nome: 'Suco Jarra 1L', preco: 15.00 }, { id: 'dose-campari', nome: 'Dose Campari', preco: 10.00 }, { id: 'dose-gin', nome: 'Dose Gin', preco: 15.00 }, { id: 'dose-redlabel', nome: 'Dose Red Label', preco: 15.00 }, { id: 'dose-oldparr', nome: 'Dose Old Parr', preco: 18.00 }],
            "Drinks": [{ id: 'drink-gintonica', nome: 'Gin Tônica', preco: 25.00 }, { id: 'drink-caipirinha', nome: 'Caipirinha', preco: 18.00 }]
        };

        let perfilAtual, mesaSelecionada;
        let comandaTemporaria = [];

        // LÓGICA DE DADOS (LOCAL STORAGE)
        const db = {
            get: (key) => JSON.parse(localStorage.getItem(key) || '{}'),
            set: (key, value) => localStorage.setItem(key, JSON.stringify(value)),
        };

        const selecionarPerfil = (perfil) => {
            perfilAtual = perfil;
            document.getElementById('perfil-view').classList.add('hidden');
            document.getElementById('main-view').classList.remove('hidden');
            const titles = { caixa: 'Painel do Caixa', atendente: 'Mapa de Mesas', cozinha: 'Painel da Cozinha' };
            document.getElementById('header-title').textContent = titles[perfil];
            ['mesas-view', 'cozinha-view'].forEach(v => document.getElementById(v).classList.add('hidden'));
            if (perfil === 'caixa' || perfil === 'atendente') {
                document.getElementById('mesas-view').classList.remove('hidden');
                setupMesasView();
            } else {
                document.getElementById('cozinha-view').classList.remove('hidden');
                setupCozinhaView();
            }
        };

        const voltarParaPerfis = () => {
            perfilAtual = null;
            document.getElementById('perfil-view').classList.remove('hidden');
            document.getElementById('main-view').classList.add('hidden');
            fecharPdvView();
            fecharDetalheCaixaView();
        };

        // LÓGICA DAS MESAS
        const setupMesasView = () => {
            const grid = document.getElementById('mesas-grid');
            grid.innerHTML = '';
            const mesas = db.get('mesas');
            for (let i = 1; i <= 50; i++) {
                const mesaData = mesas[i] || { status: 'livre', total: 0 };
                const mesaEl = document.createElement('div');
                mesaEl.className = 'p-2 rounded-lg text-center cursor-pointer transition-all duration-300';
                mesaEl.innerHTML = `<div class="font-extrabold text-3xl">${i}</div><div class="text-xs font-semibold"></div>`;
                grid.appendChild(mesaEl);
                updateMesaCard(i, mesaData);
            }
        };

        const updateMesaCard = (numero, data) => {
            const mesaEl = document.querySelector(`#mesas-grid > div:nth-child(${numero})`);
            if (!mesaEl) return;
            const status = data.status || 'livre';
            const total = data.total || 0;
            mesaEl.classList.remove('bg-green-600', 'bg-red-600', 'hover:bg-green-500', 'hover:bg-red-500');
            if (status === 'livre') {
                mesaEl.classList.add('bg-green-600', 'hover:bg-green-500');
                mesaEl.children[1].textContent = 'Livre';
            } else {
                mesaEl.classList.add('bg-red-600', 'hover:bg-red-500');
                mesaEl.children[1].textContent = formatCurrency(total);
            }
            mesaEl.onclick = () => handleMesaClick(numero, data);
        };

        const handleMesaClick = (numero, data) => {
            mesaSelecionada = { numero, ...data };
            if (perfilAtual === 'atendente') {
                abrirPdvView(numero, data);
            } else if (perfilAtual === 'caixa' && data.status === 'ocupada') {
                abrirDetalheCaixaView(data);
            }
        };

        // LÓGICA DO PDV
        const abrirPdvView = (numero, data) => {
            mesaSelecionada = { numero, ...data };
            comandaTemporaria = data.itens ? JSON.parse(JSON.stringify(data.itens)) : [];
            const pdvView = document.getElementById('pdv-view');
            pdvView.innerHTML = `
                <div class="bg-gray-800 w-full max-w-7xl h-[95vh] rounded-2xl shadow-2xl flex flex-col">
                    <header class="p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0">
                        <h2 class="text-2xl font-bold">PDV - Mesa ${numero}</h2>
                        <button onclick="fecharPdvView()" class="text-gray-400 hover:text-white"><i class="fas fa-times text-2xl"></i></button>
                    </header>
                    <div class="flex-1 flex flex-col lg:flex-row overflow-hidden">
                        <div class="lg:w-2/3 flex flex-col overflow-hidden">
                            <div class="p-3 border-b border-gray-700 flex-shrink-0"><div id="categorias-container" class="flex items-center gap-2 overflow-x-auto no-scrollbar"></div></div>
                            <div id="produtos-container" class="flex-1 p-3 overflow-y-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div>
                        </div>
                        <div class="lg:w-1/3 p-4 flex flex-col bg-gray-900/50 border-t lg:border-t-0 lg:border-l border-gray-700">
                            <h3 class="text-xl font-semibold mb-4 flex-shrink-0">Comanda da Mesa</h3>
                            <div id="comanda-itens" class="flex-1 space-y-2 overflow-y-auto no-scrollbar pr-2 mb-4"></div>
                            <div class="border-t border-gray-700 pt-4 flex-shrink-0">
                                <div class="flex justify-between items-center text-2xl font-bold mb-4"><span>Total</span><span id="comanda-total">R$ 0,00</span></div>
                                <button onclick="enviarPedido()" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors shadow-lg flex items-center justify-center gap-2"><i class="fas fa-paper-plane"></i> Salvar & Enviar para Cozinha</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            renderCategorias();
            renderProdutos(Object.keys(cardapio)[0]);
            renderComanda();
            pdvView.classList.remove('hidden');
        };
        const fecharPdvView = () => document.getElementById('pdv-view').classList.add('hidden');
        
        const renderCategorias = () => { /* ... Lógica idêntica à anterior ... */ };
        const renderProdutos = (categoria) => { /* ... Lógica idêntica à anterior ... */ };
        const adicionarItem = (item) => { /* ... Lógica idêntica à anterior ... */ };
        const changeQty = (itemId, amount) => { /* ... Lógica idêntica à anterior ... */ };
        const renderComanda = () => { /* ... Lógica idêntica à anterior ... */ };
        
        const enviarPedido = () => {
            if (comandaTemporaria.length === 0) {
                showNotification('Comanda vazia. Adicione itens para salvar.', 'error');
                return;
            }
            // 1. Salvar os dados da mesa
            const mesas = db.get('mesas');
            const novoTotal = comandaTemporaria.reduce((acc, item) => acc + (item.preco * item.quantidade), 0);
            mesas[mesaSelecionada.numero] = {
                status: 'ocupada',
                total: novoTotal,
                itens: comandaTemporaria,
                lastUpdate: new Date().toISOString()
            };
            db.set('mesas', mesas);

            // 2. Salvar o pedido para a cozinha
            const pedidosCozinha = db.get('pedidos_cozinha') || [];
            pedidosCozinha.push({
                id: `pedido-${Date.now()}`,
                mesa: mesaSelecionada.numero,
                itens: comandaTemporaria,
                status: 'pendente',
                criadoEm: new Date().toISOString()
            });
            db.set('pedidos_cozinha', pedidosCozinha);

            showNotification(`Pedido da Mesa ${mesaSelecionada.numero} salvo e enviado!`);
            fecharPdvView();
            setupMesasView(); // Atualiza a visualização das mesas
        };
        
        // LÓGICA DA COZINHA
        const setupCozinhaView = () => { /* ... Implementar com Local Storage ... */ };
        const marcarPedidoPronto = (pedidoId) => { /* ... Implementar com Local Storage ... */ };
        
        // LÓGICA DO CAIXA
        const abrirDetalheCaixaView = (data) => { /* ... Implementar com Local Storage ... */ };
        const fecharDetalheCaixaView = () => document.getElementById('caixa-detalhe-view').classList.add('hidden');
        const fecharConta = () => { /* ... Implementar com Local Storage ... */ };

        // Funções utilitárias
        const showNotification = (message, type = 'success') => {
            const el = document.getElementById('notification');
            el.querySelector('p').textContent = message;
            el.classList.remove('hidden', 'bg-green-500', 'bg-red-500');
            el.classList.add(type === 'success' ? 'bg-green-500' : 'bg-red-500');
            el.classList.add('fade-in');
            setTimeout(() => {
                el.classList.remove('fade-in');
                el.classList.add('hidden');
            }, 3000);
        };
        const formatCurrency = v => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        
        // Atribuição global das funções chamadas pelo HTML
        window.selecionarPerfil = selecionarPerfil;
        window.voltarParaPerfis = voltarParaPerfis;
        window.abrirPdvView = abrirPdvView;
        window.fecharPdvView = fecharPdvView;
        window.renderCategorias = renderCategorias;
        window.renderProdutos = renderProdutos;
        window.adicionarItem = adicionarItem;
        window.changeQty = changeQty;
        window.enviarPedido = enviarPedido;
        window.fecharDetalheCaixaView = fecharDetalheCaixaView;
        window.fecharConta = fecharConta;
        
    </script>
</body>
</html>


